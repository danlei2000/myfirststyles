<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>再一次我的</title>
  <link rel="stylesheet" href="css/reset.css" />
  <link rel="stylesheet" href="css/index.css" />
</head>

<body style="height: 1000px">
  <!--包裹器   整个页面的容器-->
  <div class="wrap">
    <!--窗口侧边栏-->
    <div class="toolBar toolWrap">
      <!--内容容器-->
      <div class="content"></div>
      <!--面包屑-->
      <div class="but list"></div>
      <!--中间列表-->
      <ul class="toolList">
        <li>
          <i class="tabIcon vip"></i>
          <em>尚品汇员</em>
        </li>
        <li>
          <i class="tabIcon cart"></i>
          <em>购物车</em>
        </li>
        <li>
          <i class="tabIcon follow"></i>
          <em>我的关注</em>
        </li>
        <li>
          <i class="tabIcon history"></i>
          <em>历史记录</em>
        </li>
        <li>
          <i class="tabIcon message"></i>
          <em>消息</em>
        </li>
        <li>
          <i class="tabIcon qus"></i>
          <em>咨询</em>
        </li>
      </ul>
      <!--回到顶部-->
      <div class="back">
        <i class="tabIcon"></i>
        <em></em>
      </div>
    </div>
    <!-- 头部区域 -->
    <header class="header">
      <!--头部第一行-->
      <div class="top">
        <div class="container">
          <!--登录-->
          <div class="login">
            <p>尚品汇欢迎您！</p>
            <p>
              <span>请</span>
              <a href="###">登录</a>
              <a href="###" class="register">免费注册</a>
            </p>
          </div>
          <!--头部导航-->
          <div class="headerNav">
            <a href="###">我的订单</a>
            <a href="###">我的购物车</a>
            <a href="###">我的尚品汇</a>
            <a href="###">尚品汇会员</a>
            <a href="###">企业采购</a>
            <a href="###">关注尚品汇</a>
            <a href="###">合作招商</a>
            <a href="###">商家后台</a>
          </div>
        </div>
      </div>
      <!--头部第二行-->
      <div class="bottom">
        <h1 class="logoArea">
          <a href="###">
            <img src="img/Logo.png" alt="尚品汇" />
          </a>
        </h1>
        <div class="searchArea">
          <form action="">
            <input type="text" />
            <button>搜索</button>
          </form>
        </div>
      </div>
    </header>
    <!--商品导航分类-->
    <div class="typeNav">
      <div class="container">
        <h2 class="all">全部商品分类</h2>
        <nav>
          <a href="###">服装城</a>
          <a href="###">美妆馆</a>
          <a href="###">尚品汇超市</a>
          <a href="###">全球购</a>
          <a href="###">闪购</a>
          <a href="###">团购</a>
          <a href="###">有趣</a>
          <a href="###">秒杀</a>
        </nav>
      </div>
    </div>
    <!--商品主要内容区域-->
    <section class="con">
      <!--路径导航（面包屑导航）-->
      <div class="conPoin">
        <!-- <a href="###">手机、数码、通讯</a>
          <a href="###">手机</a>
          <a href="###">Apple苹果</a>
          <a>iphone 6S系类</a> -->
      </div>
      <!--主要内容区域-->
      <div class="mainCon">
        <!--左侧放大镜-->
        <div class="previewWrap">
          <!--放大镜效果-->
          <div class="preview">
            <!--小图容器-->
            <div class="zoom">
              <!-- <img src="img/s1.png" alt="" /> -->
              <!-- <div class="mask"></div> -->
            </div>
            <!--大图容器-->
            <!-- <div class="bigBox">
                <img src="img/b1.png" alt="" />
              </div> -->
          </div>
          <!--缩略图效果-->
          <div class="specScroll">
            <a class="prev">&lt;</a>
            <div class="itemCon">
              <ul class="list">
                <!-- <li><img src="img/s1.png" alt="" /></li>
                  <li><img src="img/s2.png" alt="" /></li>
                  <li><img src="img/s3.png" alt="" /></li>
                  <li><img src="img/s1.png" alt="" /></li>
                  <li><img src="img/s2.png" alt="" /></li>
                  <li><img src="img/s3.png" alt="" /></li>
                  <li><img src="img/s1.png" alt="" /></li>
                  <li><img src="img/s2.png" alt="" /></li> -->
              </ul>
            </div>
            <a class="next">&gt;</a>
          </div>
        </div>
        <!--右侧商品信息-->
        <div class="infoWrap">
          <div class="info1">
            <!-- 基本商品信息 -->
          </div>
          <div class="choose">
            <div class="chooseArea">
              <div class="choosed"></div>
            </div>
            <div class="carWrap">
              <div class="controls">
                <input type="text" value="1" />
                <a href="###" class="plus">+</a>
                <a href="###" class="mins">-</a>
              </div>
              <div class="addBtn">
                <a href="###">加入购物车</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!--商品详情页-->
    <section class="productDetail">
      <!--侧边栏-->
      <aside class="aside">
        <!--选项卡切换的按钮-->
        <div class="tabWrap">
          <h4 class="active">相关分类</h4>
          <h4>推荐品牌</h4>
        </div>
        <!--选项卡内容-->
        <div class="tabContent">
          <div class="active">
            <ul class="partList">
              <li>手机</li>
              <li>手机壳</li>
              <li>内存卡</li>
              <li>iphone配件</li>
              <li>贴膜</li>
              <li>手机耳机</li>
              <li>移动电源</li>
              <li>平板电脑</li>
            </ul>
            <ul class="goodsList">
              <li>
                <div class="gImg">
                  <img src="img/part01.png" alt="" />
                </div>
                <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                <p class="price">¥6088.00</p>
                <div class="addCar">
                  <a href="###">加入购物车</a>
                </div>
              </li>
              <li>
                <div class="gImg">
                  <img src="img/part02.png" alt="" />
                </div>
                <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                <p class="price">¥6088.00</p>
                <div class="addCar">
                  <a href="###">加入购物车</a>
                </div>
              </li>
              <li>
                <div class="gImg">
                  <img src="img/part03.png" alt="" />
                </div>
                <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                <p class="price">¥6088.00</p>
                <div class="addCar">
                  <a href="###">加入购物车</a>
                </div>
              </li>
              <li>
                <div class="gImg">
                  <img src="img/part01.png" alt="" />
                </div>
                <p class="attr">Apple苹果iPhone 6s (A1699)</p>
                <p class="price">¥6088.00</p>
                <div class="addCar">
                  <a href="###">加入购物车</a>
                </div>
              </li>
            </ul>
          </div>
          <div>推荐品牌</div>
        </div>
      </aside>
      <div class="detail">
        <div class="fitting">
          <h4>选择搭配</h4>
          <div class="goodSuits">
            <div class="master">
              <img src="img/l-m01.png" alt="" />
              <p>¥5299</p>
              <i>+</i>
            </div>
            <ul class="suits">
              <li class="suitsItem">
                <img src="img/dp01.png" alt="" />
                <p>电脑包</p>
                <label>
                  <input type="checkbox" value="10" checked />
                  <span>10</span>
                </label>
              </li>
              <li class="suitsItem">
                <img src="img/dp02.png" alt="" />
                <p>USB</p>
                <label>
                  <!-- 默认勾选 -->
                  <input type="checkbox" value="20" checked />
                  <span>20</span>
                </label>
              </li>
              <li class="suitsItem">
                <img src="img/dp03.png" alt="" />
                <p>Feless费勒斯VR</p>
                <label>
                  <input type="checkbox" value="30" />
                  <span>30</span>
                </label>
              </li>
              <li class="suitsItem">
                <img src="img/dp04.png" alt="" />
                <p>Feless费勒斯VR</p>
                <label>
                  <input type="checkbox" value="40" />
                  <span>40</span>
                </label>
              </li>
            </ul>
            <div class="result">
              <div>已选购<span class="selected">0</span>件商品</div>
              <p class="price-tit">套餐价</p>
              <p class="price">¥5299</p>
              <button>加入购物车</button>
            </div>
          </div>
        </div>
        <div class="intro">
          <ul class="tabWrap">
            <li class="active"><a href="###">商品介绍</a></li>
            <li><a href="###">规格与包装</a></li>
            <li><a href="###">售后保障</a></li>
            <li><a href="###">商品评价</a></li>
            <li><a href="###">手机社区</a></li>
          </ul>
          <div class="tabContent">
            <div class="active">
              <ul class="goodsIntro">
                <li>分辨率：1920*1080(FHD)</li>
                <li>后置摄像头：1200万像素</li>
                <li>前置摄像头：500万像素</li>
                <li>核 数：其他</li>
                <li>频 率：以官网信息为准</li>
                <li>品牌： Apple</li>
                <li>商品名称：APPLEiPhone 6s Plus</li>
                <li>商品编号：1861098</li>
                <li>商品产地：中国大陆</li>
                <li>商品毛重：0.51kg</li>
                <li>热点：指纹识别，Apple Pay，金属机身，拍照神器</li>
              </ul>
              <div class="introImg">
                <img src="img/intro01.png" alt="" />
                <img src="img/intro02.png" alt="" />
                <img src="img/intro03.png" alt="" />
              </div>
            </div>
            <div>规格与包装</div>
            <div>售后保障</div>
            <div>商品评价</div>
            <div>手机社区</div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <script src="./js/data.js"></script>
  <script>
    // 等待页面加载完成后执行
    window.addEventListener('DOMContentLoaded', function () {
      thumbnail();
      thumClick();
      magnifyGlass();
      initRender();
      speciesClick();
      goodsClick();
      sidebarClick();
      bottomNav();

    })
    let index = 0;
    // 渲染缩略图及小图初始图
    function thumbnail() {
      let ul = document.querySelector(
        '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list');
      let imgSrc = goodData.imgsrc;
      // console.log(imgSrc);
      imgSrc.forEach(function (item) {
        let li = document.createElement('li');
        let img = document.createElement('img');
        img.src = item.s;
        li.appendChild(img);
        ul.appendChild(li);
      })
      let zoom = document.querySelector(
        '.wrap .con .mainCon .previewWrap .preview .zoom');
      let img = document.createElement('img');
      img.src = imgSrc[index].s;
      zoom.appendChild(img);

    }

    // 给缩略图绑定点击事件及左右箭头事件
    function thumClick() {
      let lis = document.querySelectorAll(
        '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list > li ');
      // console.log(lis);
      let imgSrc = goodData.imgsrc;
      let img = document.querySelector(
        '.wrap .con .mainCon .previewWrap .preview .zoom img');
      lis.forEach(function (item, i) {
        item.onclick = function () {
          index = i
          img.src = imgSrc[index].s;
        }
      })

      let leftPrev = document.querySelector(
        '.wrap .con .mainCon .previewWrap .specScroll .prev');
      let rightNext = document.querySelector(
        '.wrap .con .mainCon .previewWrap .specScroll .next');
      let li = document.querySelector(
        '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list > li ');
      let ul = document.querySelector(
        '.wrap .con .mainCon .previewWrap .specScroll .itemCon .list');
      // console.log(li);
      let offsetLi = parseInt(lis[0].offsetWidth) + parseInt(window.getComputedStyle(li).marginRight);
      // console.log(offsetLi);
      let offsetMove = 0;
      let offsetMax = offsetLi * (lis.length - 5);
      rightNext.onclick = function () {
        if (offsetMove === offsetMax) {
          return;
        }
        offsetMove += offsetLi;
        ul.style.left = -offsetMove + 'px';

      }
      leftPrev.onclick = function () {
        if (offsetMove === 0) {
          return;
        }
        offsetMove -= offsetLi;
        ul.style.left = -offsetMove + 'px';
      }

    }

    // 放大镜效果
    function magnifyGlass() {
      let imgSrc = goodData.imgsrc;
      let zoom = document.querySelector(
        '.wrap .con .mainCon .previewWrap .preview .zoom');
      let preview = document.querySelector(
        '.wrap .con .mainCon .previewWrap .preview');
      let mask = null;
      let bigBox = null;
      let img = null;
      zoom.onmouseenter = function () {
        mask = document.createElement('div');
        mask.className = 'mask';
        zoom.appendChild(mask);

        bigBox = document.createElement('div');
        bigBox.className = 'bigBox';
        img = document.createElement('img');
        img.src = imgSrc[index].b;
        bigBox.appendChild(img);
        preview.appendChild(bigBox);
        console.log(mask.getBoundingClientRect())
      }
      zoom.onmouseleave = function () {
        zoom.removeChild(mask);
        preview.removeChild(bigBox);
        mask = null;
        bigBox = null;
        img = null;
      }
      zoom.onmousemove = function (event) {
        let maskLeft = event.clientX - zoom.getBoundingClientRect().left - mask.offsetWidth / 2;
        let maskTop = event.clientY - zoom.getBoundingClientRect().top - mask.offsetHeight / 2;
        // console.log(maskLeft);
        let maskMaxLeft = zoom.clientWidth - mask.offsetWidth;
        let maskMaxTop = zoom.clientHeight - mask.offsetHeight;
        if (maskLeft > maskMaxLeft) {
          maskLeft = maskMaxLeft;
        } else if (maskLeft < 0) {
          maskLeft = 0;
        }
        if (maskTop > maskMaxTop) {
          maskTop = maskMaxTop;
        } else if (maskTop < 0) {
          maskTop = 0;
        }
        mask.style.left = maskLeft + 'px';
        mask.style.top = maskTop + 'px';

        let bigBoxMaxLeft = img.offsetWidth - bigBox.clientWidth;
        let bigBoxMaxTop = img.offsetHeight - bigBox.clientHeight;
        let bigBoxLeft = bigBoxMaxLeft / maskMaxLeft * maskLeft;
        let bigBoxTop = bigBoxMaxTop / maskMaxTop * maskTop;
        img.style.top = -bigBoxTop + 'px';
        img.style.left = -bigBoxLeft + 'px';
      }

    }
    let goodsindex = 0;
    // 初次渲染页面
    function initRender() {
      let info = document.querySelector(
        '.wrap .con .mainCon .infoWrap .info1');
      let goodsDetail = goodData.goodsDetail;
      // console.log(goodsDetail);
      let initPage = `
            <h3 class="infoName">${goodsDetail.title}</h3>
            <p class="news">${goodsDetail.recommend}</p>
            <div class="priceArea">
              <div class="priceArea1">
                <div class="title">价&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;格</div>
                <div class="price">
                  <i>￥</i>
                  <em>${goodsDetail.price}</em>
                  <span>降价通知</span>
                </div>
                <div class="remark">
                  <i>累计评价</i>
                  <span>${goodsDetail.evaluateNum}</span>
                </div>
              </div>
              <div class="priceArea2">
                <div class="title">促&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;销</div>
                <div class="fixWidth">
                  <i>${goodsDetail.promoteSales.type}</i>
                  <span>${goodsDetail.promoteSales.content} </span>
                </div>
              </div>
            </div>
            <div class="support">
              <div>
                <div class="title">支&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;持</div>
                <div class="fixWidth">${goodsDetail.support}</div>
              </div>
              <div>
                <div class="title">配&nbsp;送&nbsp;至</div>
                <div class="fixWidth">${goodsDetail.address}</div>
              </div>
            </div>`
      info.innerHTML = initPage;

      let chooseArea = document.querySelector(
        '.wrap .con .mainCon .infoWrap .choose .chooseArea'
      );
      let speciesList = goodsDetail.crumbData;
      speciesList.forEach(function (item) {
        let dl = document.createElement('dl');
        let dt = document.createElement('dt');
        dt.innerText = item.title;
        dl.appendChild(dt);
        item.data.forEach(function (ddItem) {
          let dd = document.createElement('dd');
          dd.innerText = ddItem.type;
          dd.setAttribute('price', ddItem.changePrice);
          dl.appendChild(dd);
        })
        chooseArea.appendChild(dl);
      })



      let origPrice = goodData.goodsDetail.price;
      let leftPrice = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .master p'
      );
      let rightPrice = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .result .price'
      );
      let inputs = document.querySelectorAll(
        '.wrap .productDetail .detail .fitting .goodSuits .suits .suitsItem label input');
      let span = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .result span'
      );
      leftPrice.innerText = '￥' + origPrice;
      inputs.forEach(function (inputItem) {
        if (inputItem.checked) {
          goodsindex++;
          origPrice += parseInt(inputItem.value);
        }
      })

      rightPrice.innerText = '￥' + origPrice;
      span.innerText = goodsindex;


    }

    let arrSpecies = new Array(goodData.goodsDetail.crumbData.length);
    arrSpecies.fill(0);

    // 给品种列表绑定事件
    function speciesClick() {
      let dl = document.querySelectorAll(
        '.wrap .con .mainCon .infoWrap .choose .chooseArea dl'
      );
      let choosed = document.querySelector(
        '.wrap .con .mainCon .infoWrap .choose .chooseArea .choosed'
      );
      dl.forEach(function (dlItem, dlIndex) {
        let dd = dlItem.querySelectorAll(
          'dd'
        );
        dd.forEach(function (ddItem, ddIndex) {
          ddItem.onclick = function () {
            arrSpecies[dlIndex] = { name: this.innerText, ddIndex: ddIndex };
            console.log(arrSpecies);
            choosed.innerHTML = '';
            arrSpecies.forEach(function (arrItem, arrIndex) {
              if (arrItem === 0) {
                return;
              }
              let mark = document.createElement('mark');
              mark.innerText = arrItem.name;
              mark.setAttribute('index', arrIndex);
              let a = document.createElement('a');
              a.innerText = 'x';
              mark.appendChild(a);
              choosed.appendChild(mark);
            })
            priceChange();
            dd.forEach(function (item) {
              item.style.color = '#666';
            })
            this.style.color = 'red';


            // 给选项的X号绑定事件
            let marks = document.querySelectorAll(
              '.wrap .con .mainCon .infoWrap .choose .chooseArea .choosed mark');
            marks.forEach(function (markItem) {
              let aClick = markItem.querySelector('a');
              aClick.onclick = function () {
                arrSpecies[markItem.getAttribute('index')] = 0;
                // console.log(arrSpecies);
                choosed.removeChild(markItem);
                let dds = dl[markItem.getAttribute('index')].querySelectorAll('dd');
                dds.forEach(function (item1) {
                  item1.style.color = "#333";
                })
                dds[0].style.color = 'red';
                priceChange();
              }
            })

          }
        })
        // console.log(dd);
      })


    }

    // 手机选项改变时触发
    function priceChange() {
      let origPrice = goodData.goodsDetail.price;
      let dl = document.querySelectorAll(
        '.wrap .con .mainCon .infoWrap .choose .chooseArea dl'
      );
      let em = document.querySelector(
        '.wrap .con .mainCon .infoWrap .info1 .priceArea .priceArea1 .price em'
      );
      let leftPrice = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .master p'
      );
      let rightPrice = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .result .price'
      );
      arrSpecies.forEach(function (arrItem, arrIndex) {
        if (arrItem === 0) {
          return;
        }
        let changePrice = parseInt(dl[arrIndex].querySelectorAll('dd')[arrItem.ddIndex].getAttribute('price'));
        // console.log(changePrice);
        origPrice += changePrice;
      })
      em.innerText = origPrice;
      leftPrice.innerText = origPrice;

      let inputs = document.querySelectorAll(
        '.wrap .productDetail .detail .fitting .goodSuits .suits .suitsItem label input');
      // let span = document.querySelector(
      //   '.wrap .productDetail .detail .fitting .goodSuits .result span'
      // );
      inputs.forEach(function (inputItem) {
        if (inputItem.checked) {
          // goodsindex++;
          origPrice += parseInt(inputItem.value);
        }
      })
      rightPrice.innerText = origPrice;
      // span.innerText = goodsindex;

    }

    // 给选择搭配绑定点击事件
    function goodsClick() {
      let inputs = document.querySelectorAll(
        '.wrap .productDetail .detail .fitting .goodSuits .suits .suitsItem label input');
      let span = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .result span'
      );
      let rightPrice = document.querySelector(
        '.wrap .productDetail .detail .fitting .goodSuits .result .price'
      );


      inputs.forEach(function (inputItem) {
        // console.log(inputItem);
        inputItem.onclick = function () {
          let origePrice = parseInt(rightPrice.innerText.slice(1));
          if (this.checked) {
            goodsindex++;
            origePrice += parseInt(this.value);
          } else {
            goodsindex--;
            origePrice -= parseInt(this.value)
          }
          rightPrice.innerText = '￥' + origePrice;
          span.innerText = goodsindex;
        }

      })


    }


    // 给侧边栏绑定点击事件
    function sidebarClick() {
      let list = document.querySelector(
        '.wrap .toolBar .but');
      let toolBar = document.querySelector(
        '.wrap .toolBar'
      );
      let target = true;
      list.onclick = function () {
        if (target) {
          this.classList.replace('list', 'cross');
          toolBar.classList.replace('toolWrap', 'toolOut')
        } else {
          this.classList.replace('cross', 'list');
          toolBar.classList.replace('toolOut', 'toolWrap');
        }
        target = !target;
      }


      let lis = document.querySelectorAll(
        '.wrap .toolBar .toolList li'
      );
      lis.forEach(function (liItem) {
        let i = liItem.querySelector('.tabIcon')
        i.onmouseenter = function () {
          this.style.backgroundColor = 'rgb(200,17,34)';
          liItem.querySelector('em').style.left = '-62px';
        }
        i.onmouseleave = function () {
          this.style.backgroundColor = 'rgb(122,110,110)';
          liItem.querySelector('em').style.left = '35px';
        }
      })


    }

    // 下边导航切换
    function bottomNav() {
      let leftNavs = document.querySelectorAll(
        '.wrap .productDetail .aside .tabWrap h4'
      );
      let leftContents = document.querySelectorAll(
        '.wrap .productDetail .aside .tabContent > div'
      );
      let rightNavs = document.querySelectorAll(
        '.wrap .productDetail .detail .intro .tabWrap li'
      );
      let rightContents = document.querySelectorAll(
        '.wrap .productDetail .detail .intro .tabContent > div'
      );
      leftNavs.forEach(function (navItem, navIndex) {
        navItem.onclick = function () {
          leftNavs.forEach(function (item) {
            item.className = '';
          })
          this.className = 'active';

          leftContents.forEach(function (itemc) {
            itemc.className = '';
          })
          leftContents[navIndex].className = 'active';

        }
      })

      rightNavs.forEach(function (rItem, rIndex) {
        rItem.onclick = function () {
          rightNavs.forEach(function (item0) {
            item0.className = '';
          })
          this.className = 'active';

          rightContents.forEach(function (item1) {
            item1.className = '';
          })
          rightContents[rIndex].className = 'active';
        }
      })

    }
  </script>
</body>

</html>